<project>

	<property name="nutch-version" value="101tec-nutch-aebe2c3e80012a3d1764d38fd2eb2da6a414c225" />

	<target name="init">
		<mkdir dir="build" />
	</target>

	<target name="clean">
		<delete dir="build" />
	</target>


	<target name="unzip-nutch" depends="init">
		<unzip src="contrib/${nutch-version}.zip" dest="build" />
	</target>

	<target name="patch-nutch">
		<patch patchfile="patches/build.xml.patch" dir="build/${nutch-version}" strip="1" />
		<patch patchfile="patches/Query.patch" dir="build/${nutch-version}" strip="1" />
		<patch patchfile="patches/core-build.xml.patch" dir="build/${nutch-version}" strip="1" />
		<patch patchfile="patches/nutch.patch" dir="build/${nutch-version}" strip="1" />
	</target>


	<target name="copy-administration-plugins">
		<antcall target="copy-admin-url-maintenance" />
	</target>

	<target name="copy-admin-url-maintenance">
		<copy todir="build/${nutch-version}/src/plugin/admin-urlmaintenance">
			<fileset dir="portalu-nutch-gui/src/plugin/admin-urlmaintenance" />
		</copy>
	</target>

	<target name="copy-css">
		<copy todir="build/${nutch-version}/conf/webapp/portal-u">
			<fileset dir="portalu-nutch-gui/conf/webapp/portal-u" />
		</copy>
	</target>

	<target name="copy-portalu-search">
		<copy todir="build/${nutch-version}/src/java/de">
			<fileset dir="portalu-search/src/main/java/de" />
		</copy>
		<antcall target="copy-portalu-search-libs" />
	</target>

	<target name="copy-portalu-search-libs">
		<exec dir="portalu-search" executable="mvn">
			<arg line="dependency:copy-dependencies -DoutputDirectory=${basedir}/build/${nutch-version}/lib/ingrid-ext"/>
		</exec>

	</target>

	<target name="copy-start-scripts">
		<copy todir="build/${nutch-version}">
			<fileset dir="portalu-search/src/main/scripts" />
		</copy>
	</target>

	<target name="conf.check">
		<condition property="conf.exists">
			<available file="portalu-search/conf/${deploy.mode}" />
		</condition>
	</target>

	<target name="copy-configs" depends="conf.check" if="conf.exists">
		<copy todir="build/${nutch-version}/conf">
			<fileset dir="portalu-search/conf/${deploy.mode}/" />
		</copy>
	</target>


	<target name="dist" depends="unzip-nutch, patch-nutch, copy-administration-plugins, copy-css, copy-portalu-search, copy-start-scripts, copy-configs">
		<!--<ant antfile="build/${nutch-version}/build.xml" target="tar" />-->
	</target>

</project>